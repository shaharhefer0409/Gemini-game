<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Neon Nexus Mobile</title>
    <style>
        body { margin: 0; padding: 0; background-color: #000; position: fixed; inset: 0; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; touch-action: none; color: white; user-select: none; -webkit-user-select: none; }
        #gameContainer { position: relative; width: 100%; height: 100%; }
        canvas { display: block; width: 100%; height: 100%; }
        
        /* Safe Area HUD - Adjusts for the phone's notch/dynamic island */
        .hud { position: absolute; z-index: 5; pointer-events: none; text-shadow: 0 2px 4px #000; font-weight: bold; }
        #scoreBoard { top: calc(20px + env(safe-area-inset-top)); left: 20px; font-size: 24px; color: #0ff; }
        #hiScoreBoard { top: calc(20px + env(safe-area-inset-top)); right: 20px; font-size: 18px; color: #f0f; opacity: 0.8; }
        
        #energyContainer { top: calc(60px + env(safe-area-inset-top)); left: 20px; width: 150px; height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden; border: 1px solid rgba(0, 255, 0, 0.3); }
        #energyFill { width: 0%; height: 100%; background: linear-gradient(90deg, #050, #0f0); box-shadow: 0 0 15px #0f0; transition: width 0.4s ease-out; }
        
        #ui-layer { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(15px); z-index: 10; text-align: center; }
        h1 { font-size: 12vw; color: #0ff; text-shadow: 0 0 25px #0ff; margin: 0; font-weight: 900; }
        button { padding: 20px 60px; font-size: 24px; background: #0ff; color: #000; border: none; border-radius: 50px; cursor: pointer; margin-top: 30px; font-weight: 900; text-transform: uppercase; box-shadow: 0 0 20px #0ff; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="gameContainer">
        <div id="scoreBoard" class="hud">Score: 0</div>
        <div id="hiScoreBoard" class="hud">Best: 0</div>
        <div id="energyContainer" class="hud"><div id="energyFill"></div></div>
        <canvas id="gameCanvas"></canvas>
        <div id="ui-layer">
            <h1 id="title">NEON NEXUS</h1>
            <p>TOUCH LEFT/RIGHT SIDES TO MOVE</p>
            <button id="startBtn">ENGAGE</button>
        </div>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const ui = document.getElementById('ui-layer');
    const scoreDisplay = document.getElementById('scoreBoard');
    const energyFill = document.getElementById('energyFill');

    let audioCtx;
    let isGameOver = true;
    let score = 0;
    let energy = 0;
    const MAX_ENERGY = 8;
    let difficulty = 1;
    let entities = [];
    let particles = [];
    let stars = [];
    let shake = 0;

    const player = { x: 0, y: 0, dx: 0, speed: 850, tilt: 0, shield: false, shieldTime: 0 };

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        player.y = canvas.height - 150;
        player.x = canvas.width / 2;
    }
    window.addEventListener('resize', resize);
    resize();

    // Vibrate function for mobile feedback
    function vibrate(ms) { if (navigator.vibrate) navigator.vibrate(ms); }

    // Touch Controls
    window.addEventListener('touchstart', (e) => {
        if (isGameOver) return;
        const x = e.touches[0].clientX;
        player.dx = x < canvas.width / 2 ? -player.speed : player.speed;
        e.preventDefault();
    }, {passive: false});

    window.addEventListener('touchend', () => player.dx = 0);

    class Entity {
        constructor() {
            this.type = Math.random() < 0.25 ? 'cell' : 'enemy';
            this.size = this.type === 'cell' ? 25 : 40;
            this.x = Math.random() * (canvas.width - this.size);
            this.y = -60;
            this.speed = (400 + Math.random() * 200) * (difficulty * 0.8);
            this.color = this.type === 'cell' ? '#0f0' : '#f0f';
        }
        update(dt) { this.y += this.speed * dt; }
        draw() {
            ctx.fillStyle = this.color;
            ctx.shadowBlur = 15; ctx.shadowColor = this.color;
            if (this.type === 'cell') { ctx.beginPath(); ctx.arc(this.x + 12, this.y + 12, 12, 0, Math.PI*2); ctx.fill(); }
            else { ctx.fillRect(this.x, this.y, this.size, this.size); }
            ctx.shadowBlur = 0;
        }
    }

    function update(timestamp) {
        if (isGameOver) return;
        let dt = 0.016; // Standard 60fps frame delta

        ctx.fillStyle = 'black'; ctx.fillRect(0,0,canvas.width, canvas.height);

        player.x += player.dx * dt;
        player.x = Math.max(30, Math.min(canvas.width - 30, player.x));

        // Draw Player
        ctx.fillStyle = player.shield ? '#0f0' : '#0ff';
        ctx.shadowBlur = 20; ctx.shadowColor = ctx.fillStyle;
        ctx.beginPath();
        ctx.moveTo(player.x, player.y - 30);
        ctx.lineTo(player.x + 25, player.y + 20);
        ctx.lineTo(player.x - 25, player.y + 20);
        ctx.fill();

        for (let i = entities.length - 1; i >= 0; i--) {
            const ent = entities[i];
            ent.update(dt); ent.draw();
            
            // Collision
            const dist = Math.hypot(player.x - (ent.x + ent.size/2), player.y - (ent.y + ent.size/2));
            if (dist < 45) {
                if (ent.type === 'cell') {
                    entities.splice(i, 1);
                    energy = Math.min(energy + 2, MAX_ENERGY);
                    vibrate(40); // Soft tap
                    if (energy >= MAX_ENERGY) { player.shield = true; player.shieldTime = 5; energy = 0; }
                } else if (!player.shield) {
                    vibrate([100, 50, 100]); // Double vibration on death
                    isGameOver = true;
                    ui.classList.remove('hidden');
                    document.getElementById('title').innerText = "SYSTEM FAILURE";
                } else {
                    entities.splice(i, 1);
                    vibrate(60); // Shield hit tap
                }
            }
            if (ent.y > canvas.height) { entities.splice(i, 1); score += 10; scoreDisplay.innerText = "Score: " + score; difficulty += 0.01; }
        }
        
        energyFill.style.width = (energy / MAX_ENERGY) * 100 + '%';
        if (player.shield) {
            player.shieldTime -= dt;
            if (player.shieldTime <= 0) player.shield = false;
        }

        requestAnimationFrame(update);
    }

    function spawn() {
        if (isGameOver) return;
        entities.push(new Entity());
        setTimeout(spawn, 800 / difficulty);
    }

    document.getElementById('startBtn').onclick = () => {
        isGameOver = false; score = 0; energy = 0; difficulty = 1; entities = [];
        ui.classList.add('hidden');
        spawn();
        update();
    };
</script>
</body>
</html>
